@using StockApp.Client.Interfaces
@using StockApp.Shared.Models
@using Microsoft.FluentUI.AspNetCore.Components
@using ScottPlot.Blazor
@using ScottPlot.Finance
@using ScottPlot
@inject IQuoteService quoteService
@attribute [Authorize]

<h3>Investors Watch</h3>

<FluentHorizontalScroll Speed="600" Easing=ScrollEasing.EaseInOut Style="width:auto;height:150px;">
    @if (quoteData is not null)
    {
        @foreach (var quote in quoteData)
        {
            <FluentCard>

                <h5><a href="/candlestick?symbol=@quote.Symbol">@quote.Symbol</a></h5>
                <h6 style="width:125px;">@GetShortName(@quote.ShortName, 15)</h6>
                <span class="label">@quote.RegularMarketPrice.ToString("F2")</span>
                <span class="value @(quote.RegularMarketChange >= 0 ? "text-success" : "text-danger")">@quote.RegularMarketChangePercent.ToString("F2")%</span>
            </FluentCard>
        }
    }
</FluentHorizontalScroll>
@code {
    public string[] Symbol { get; set; } = { "NFLX", "AMZN", "GOOG", "TSLA", "DIS", "AAPL", "AMD", "NVDA", "JPM", "F", "MSFT", "PYPL", "INTC" };

    private List<Result> quoteData = new();

    JustifyContent Justification = JustifyContent.FlexStart;

    int Spacing = 1;

    private string GetShortName(string name, int maxLength)
    {
        if (string.IsNullOrEmpty(name))
        {
            return name;
        }
        return name.Length <= maxLength ? name : name.Substring(0, maxLength) + "...";
    }

    protected override async Task OnInitializedAsync()
    {
        var stockData = await quoteService.GetQuotesData(Symbol);
        quoteData = stockData.Data.QuoteResponse.Result;
    }
}
